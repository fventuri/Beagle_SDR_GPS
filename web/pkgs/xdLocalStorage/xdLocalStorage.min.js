

/* web/pkgs/xdLocalStorage/xdLocalStorage.min.js */
"use strict";window.xdLocalStorage=window.xdLocalStorage||function(){var e,n="cross-domain-local-message",t={iframeId:"cross-domain-iframe",iframeUrl:void 0,initCallback:function(){}},i=-1,o={},a=!1,l=!1;function r(e){var i;try{i=JSON.parse(e.data)}catch(e){}i&&i.namespace===n&&("iframe-ready"===i.id?(l=!0,t.initCallback()):function(e){o[e.id]&&(o[e.id](e),delete o[e.id])}(i))}function c(t,a,l,r){o[++i]=r;var c={namespace:n,etag:0,server:0,id:i,action:t,key:a,value:l};e.contentWindow.postMessage(JSON.stringify(c),"*")}function s(n){t=XdUtils.extend(n,t);var i=document.createElement("div");window.addEventListener?window.addEventListener("message",r,!1):window.attachEvent("onmessage",r),i.innerHTML='<iframe id="'+t.iframeId+'" src='+t.iframeUrl+' style="display: none;"></iframe>',document.body.appendChild(i),e=document.getElementById(t.iframeId)}function d(){return a?!!l||(console.log("You must wait for iframe ready message before using the api."),!1):(console.log("You must call xdLocalStorage.init() before using it."),!1)}return{init:function(e){if(!e.iframeUrl)throw"You must specify iframeUrl";a?console.log("xdLocalStorage was already initialized!"):(a=!0,"complete"===document.readyState?s(e):window.onload=function(){s(e)})},setItem:function(e,n,t){d()&&c("set",e,n,t)},getItem:function(e,n){d()&&c("get",e,null,n)},removeItem:function(e,n){d()&&c("remove",e,null,n)},key:function(e,n){d()&&c("key",e,null,n)},getSize:function(e){d()&&c("size",null,null,e)},getLength:function(e){d()&&c("length",null,null,e)},clear:function(e){d()&&c("clear",null,null,e)},wasInit:function(){return a}}}(),window.xdLocalStorageHA=window.xdLocalStorageHA||function(){var e="cross-domain-local-message",n={iframeId:"cross-domain-iframe",iframeUrls:void 0,initCallback:function(){}},t=-1,i=[],o=[],a=0,l={},r=[],c=!1,s=!1;function d(n){var t;try{t=JSON.parse(n.data)}catch(e){}t&&t.namespace===e&&("iframe-ready"===t.id||("ping"===t.action?(o[t.server]=!0,a++,console.log("XDLS ping reply server="+t.server+" seen_ct="+a)):r[t.server]=t))}function u(n,a,c,s){l[++t]=s;for(var d={namespace:e,etag:Date.now(),id:t,action:n,key:a,value:c},u=0;u<i.length;u++)("ping"==n||o[u])&&(d.server=u,r[u]=null,i[u].contentWindow.postMessage(JSON.stringify(d),"*"));"ping"!=n&&setTimeout(function(){for(var e=-1,n=-1,t=0;t<i.length;t++){var o=r[t];if(null!=o){var a=o.etag?o.etag:0;a>e&&(e=a,n=t)}}-1!=n?function(e){l[e.id]&&(l[e.id](e),delete l[e.id])}(r[n]):console.log("XDLS wait longer for response?")},250)}function f(e){n=XdUtils.extend(e,n),window.addEventListener?window.addEventListener("message",d,!1):window.attachEvent("onmessage",d);var t=0;n.iframeUrls.forEach(function(e){var o="id-"+n.iframeId+"-"+t,a=document.createElement("div");w3_add(a,"id-"+n.iframeId),a.innerHTML='<iframe id="'+o+'" src='+e+' style="display: none;"></iframe>',document.body.appendChild(a),i[t]=document.getElementById(o),t++})}function m(){return c?!!s||(console.log("You must wait for iframe ready message before using the api."),!1):(console.log("You must call xdLocalStorage.init() before using it."),!1)}return setTimeout(function(){u("ping",null,null,null),setTimeout(function(){console.log("XDLS seen servers="+a),s=!0,n.initCallback()},1e3)},5e3),{init:function(e){if(!e.iframeUrls)throw"You must specify iframeUrls";c?console.log("xdLocalStorage was already initialized!"):(c=!0,"complete"===document.readyState?f(e):window.onload=function(){f(e)})},setItem:function(e,n,t){m()&&u("set",e,n,t)},getItem:function(e,n){m()&&u("get",e,null,n)},removeItem:function(e,n){m()&&u("remove",e,null,n)},key:function(e,n){m()&&u("key",e,null,n)},getSize:function(e){m()&&u("size",null,null,e)},getLength:function(e){m()&&u("length",null,null,e)},clear:function(e){m()&&u("clear",null,null,e)},wasInit:function(){return c}}}();


